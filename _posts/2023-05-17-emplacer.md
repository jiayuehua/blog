---
layout: post
title:  "emplacer, inserter的好兄弟"
date:   2023-05-17 09:54:58 +0800
categories: jekyll update
tags:
  container 
---

STL中有插入器如back_inserter，被赋值时将调用容器的push_back函数，C\++11后容器增加了emplace成员，folly提供了对应的emplacer，如back_emplacer，被赋值时将调用容器的emplace_back成员。

    #include <gtest/gtest.h>
    #include <folly/Utility.h>
    #include <folly/container/Iterator.h>
    #include <type_traits>
    #include <algorithm>
    #include <utility>
    #include <ranges>
    #include <deque>
    #include <list>

    TEST(emplacer,back)
    {
      std::vector<int> a{1,2,3};
      std::vector<std::pair<int,int>> b;
      std::transform(a.begin(), a.end(), folly::back_emplacer(b),
                     [](int i) {
        return folly::make_emplace_args(i,i+1);//back_emplace param, perfect forward and backward i,i+1 。
        });
      EXPECT_EQ(b[0].first,1);
    }

    TEST(emplacer,front)
    {
      std::vector<int> a{1,2,3};
      std::deque<std::pair<int,int>> b;
      std::transform(a.begin(), a.end(), folly::front_emplacer(b), [](int i) {
        return folly::make_emplace_args(i,i+1);
        });
      EXPECT_EQ(b[0].first,3);
    }

    TEST(emplacer,emplacer)
    {
      std::vector<int> a{1,2,3};
      std::list<std::pair<int,int>> b;
      std::transform(a.begin(),a.end(), folly::emplacer(b, b.begin()),
                     [](int i) {
        return folly::make_emplace_args(i,i+1);
        });
      EXPECT_EQ(b.front().first, 1);
    }

